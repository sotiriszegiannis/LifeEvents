@inject UsersRepository UsersRepository
@inject MoneyRepository MoneyRepository
<div>
    <div class="d-flex flex-row">        
        @if (Income > 0)
        {
            <div class="">
                <li class="list-inline-item">
                    <MudButton OnClick="@(async () => await OpenChart(Domain.MoneyTransactionTypeEnum.Income))">
                        <div style="display:flex;color:white">
                            <MudIcon Icon="@Icons.Material.Filled.ArrowUpward" Color="Color.Success" />
                            <h5 class="mb-1">
                                € +@Income
                            </h5>
                        </div>
                    </MudButton>
                </li>
            </div>
        }
        <div class="">
            @if (Expenses > 0)
            {
                <li class="list-inline-item">
                    <MudButton OnClick="@(async () => await OpenChart(Domain.MoneyTransactionTypeEnum.Expense))">
                        <div style="display:flex;color:white">
                            <MudIcon Icon="@Icons.Material.Filled.ArrowDownward" Color="Color.Error" />
                            <h5 class="mb-1">
                                € -@Expenses
                            </h5>
                        </div>
                    </MudButton>                    
                </li>
            }
        </div>
    </div>
</div>

@code {
    [Inject] IDialogService DialogService { get; set; } = default!;
    int Income { get; set; }
    int Expenses { get; set; }
    [Parameter]
    public List<Repository.MoneyTransactionRDTO> Transactions { get; set; }
    protected async override Task OnInitializedAsync()
    {
        await UpdateUI();
        await base.OnInitializedAsync();
    } 
    protected override async Task OnParametersSetAsync()
    {
        await UpdateUI();
        await base.OnParametersSetAsync();
        // Update your UI here
    }
    private async Task OpenChart(Domain.MoneyTransactionTypeEnum type)
    {
        var User = await UsersRepository.Get();
        var results = await MoneyRepository.GetPerMonth(
            DateTime.UtcNow.AddYears(-1),
            DateTime.UtcNow,
            new UserRDTO()
        {
			Id = User.Id,
			TimeZone = User.TimeZone,
			Name = User.Name
        },
        type);
        var parameters = new DialogParameters
        {
            { "Title", type.ToString() },
            { "XAxisLabels", results.Select(x => x.Month.ToString("MMM")).ToArray() },
            { "YAxisValues", results.Select(x => (double)x.Amount).ToArray() }
        };

        var options = new DialogOptions { MaxWidth = MaxWidth.Large, FullWidth = true };
        DialogService.Show<MoneyLineChart>("Report", parameters,options);
    }
    private async Task UpdateUI()
    {
        if (Transactions != null && Transactions.Count > 0)
        {
            Income = (int)Transactions.Where(x => x != null && x.Type == Domain.MoneyTransactionTypeEnum.Income).Sum(x => x.Amount);
            Expenses = (int)Transactions.Where(x => x != null && x.Type == Domain.MoneyTransactionTypeEnum.Expense).Sum(x => x.Amount);
        }
        else
        {
            var User = await UsersRepository.Get();
            var from = DateTime.UtcNow.GetFirstDayOfMonth().ToIanaTimeZone(User.TimeZone);
            var to = DateTime.UtcNow.ToIanaTimeZone(User.TimeZone);
            var allTransactions = await MoneyRepository.GetAll(from, to, User);
            Income = (int)allTransactions.Where(x => x.Type == Domain.MoneyTransactionTypeEnum.Income).Sum(x => x.Amount);
            Expenses = (int)allTransactions.Where(x => x.Type == Domain.MoneyTransactionTypeEnum.Expense).Sum(x => x.Amount);
        }
    }
}