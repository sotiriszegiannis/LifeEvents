
name: CI/CD Pipeline

on:
  workflow_dispatch:

jobs:
  deploy-to-contabo-windows-vps:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Setup .NET Core
      uses: actions/setup-dotnet@v2
      with:
        dotnet-version: '7.0'

    - name: Restore dependencies
      run: dotnet restore

    - name: Build the project
      run: dotnet build --configuration Release --no-restore

    #- name: Run tests (if any)
    #  run: dotnet test --no-restore --verbosity normal

    - name: Publish to Web Deploy Package
      run: dotnet publish ./WebApp/WebApp.csproj -c Release /p:WebPublishMethod=Package /p:PackageLocation=./output/LifeEventsApp.zip
      
    - name: Deploy to IIS using Web Deploy
      run: msdeploy.exe -verb:sync -source:package='./output/LifeEventsApp.zip' -dest:auto,computerName='https://149.102.141.242:8172/msdeploy.axd?site=LifeEvents',userName='life_event_git_user',password='{{ secrets.life_events_git_user_pwd }}',authtype='Basic' -allowUntrusted=true
